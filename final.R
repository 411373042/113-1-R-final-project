library(shiny)
library(ggplot2)
library(dplyr)

# 創建資料框
data <- data.frame(
  Year_Month = c(
    "100年 1月", "100年 2月", "100年 3月", "100年 4月", "100年 5月", "100年 6月", "100年 7月", "100年 8月", 
    "100年 9月", "100年 10月", "100年 11月", "100年 12月", "101年 1月", "101年 2月", "101年 3月", 
    "101年 4月", "101年 5月", "101年 6月", "101年 7月", "101年 8月", "101年 9月", "101年 10月", 
    "101年 11月", "101年 12月", "102年 1月", "102年 2月", "102年 3月", "102年 4月", "102年 5月", 
    "102年 6月", "102年 7月", "102年 8月", "102年 9月", "102年 10月", "102年 11月", "102年 12月", 
    "103年 1月", "103年 2月", "103年 3月", "103年 4月", "103年 5月", "103年 6月", "103年 7月", 
    "103年 8月", "103年 9月", "103年 10月", "103年 11月", "103年 12月", "104年 1月", "104年 2月", 
    "104年 3月", "104年 4月", "104年 5月", "104年 6月", "104年 7月", "104年 8月", "104年 9月", 
    "104年 10月", "104年 11月", "104年 12月", "105年 1月", "105年 2月", "105年 3月", "105年 4月", 
    "105年 5月", "105年 6月", "105年 7月", "105年 8月", "105年 9月", "105年 10月", "105年 11月", 
    "105年 12月", "106年 1月", "106年 2月", "106年 3月", "106年 4月", "106年 5月", "106年 6月", 
    "106年 7月", "106年 8月", "106年 9月", "106年 10月", "106年 11月", "106年 12月", "107年 1月", 
    "107年 2月", "107年 3月", "107年 4月", "107年 5月", "107年 6月", "107年 7月", "107年 8月", 
    "107年 9月", "107年 10月", "107年 11月", "107年 12月", "108年 1月", "108年 2月", "108年 3月", 
    "108年 4月", "108年 5月", "108年 6月", "108年 7月", "108年 8月", "108年 9月", "108年 10月", 
    "108年 11月", "108年 12月", "109年 1月", "109年 2月", "109年 3月", "109年 4月", "109年 5月", 
    "109年 6月", "109年 7月", "109年 8月", "109年 9月", "109年 10月", "109年 11月", "109年 12月", 
    "110年 1月", "110年 2月", "110年 3月", "110年 4月", "110年 5月", "110年 6月", "110年 7月", 
    "110年 8月", "110年 9月", "110年 10月", "110年 11月", "110年 12月", "111年 1月", "111年 2月", 
    "111年 3月", "111年 4月", "111年 5月", "111年 6月", "111年 7月", "111年 8月", "111年 9月", 
    "111年 10月", "111年 11月", "111年 12月", "112年 1月", "112年 2月", "112年 3月", "112年 4月", 
    "112年 5月", "112年 6月", "112年 7月", "112年 8月", "112年 9月", "112年 10月", "112年 11月", 
    "112年 12月", "113年 1月", "113年 2月", "113年 3月", "113年 4月", "113年 5月", "113年 6月", 
    "113年 7月", "113年 8月", "113年 9月", "113年 10月", "113年 11月", "113年 12月"
  ),
  Value = c(
    89.28, 95.83, 86.78, 91.31, 92.13, 94.6, 98.43, 95.99, 94.63, 94.76, 91.27, 92.32, 
    98.84, 94.73, 90.44, 92.64, 90.54, 90.89, 94.29, 93.61, 92.91, 89.07, 89.52, 90.35, 
    89.66, 97.11, 89.2, 89.59, 89.17, 90.52, 90.44, 92.37, 90.98, 86.51, 88.59, 88.6, 
    90.05, 93.67, 90.03, 89.38, 90.45, 89.91, 91.59, 90.85, 86.9, 85.03, 84.93, 82.23, 
    86.18, 91.74, 83.97, 87.09, 85.86, 84.48, 86.09, 86.77, 84.44, 82.68, 82.34, 80.62, 
    82.07, 88.01, 78.72, 83.46, 82.25, 82.82, 84.06, 81.72, 81.4, 81.84, 78.1, 80.41, 
    82.74, 82.21, 78.82, 81.55, 81.9, 76.9, 80.35, 80.26, 77.07, 80.31, 76.17, 77.99, 
    76.06, 83.05, 74.49, 79.13, 76.19, 77.88, 77.91, 78.65, 78.99, 75.99, 77.92, 78.73, 
    76.08, 82.38, 77.7, 78.74, 75.82, 78.92, 76.15, 79.02, 77.4, 78.36, 75.94, 77.15, 
    75.92, 82.26, 78.2, 80.13, 79.74, 78.67, 78.76, 77.69, 78.16, 76.48, 78.43, 78.13, 
    78.33, 81.71, 78.82, 79.44, 80.54, 79.21, 79.66, 78.43, 77.51, 77.48, 78.2, 78.14, 
    77.52, 78.49, 78.83, 79.1, 79.93, 80.12, 79.29, 78.53, 79.12, 78.5, 78.17, 78.9, 
    79.02, 79.72, 79.15, 78.65, 79.34, 79.19, 79.45, 78.92, 78.38, 77.84, 78.21, 78.09,
    78.16, 76.48, 78.43, 78.13,78.33, 81.71, 78.82, 79.44, 80.54, 79.21, 79.66, 78.43  
  )
)

# Create the UI for the Shiny app
ui <- fluidPage(
  titlePanel("年度折線圖"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("year", "選擇年份", 
                  choices = unique(substring(data$Year_Month, 1, 3)),
                  selected = "100年")
    ),
    
    mainPanel(
      plotOutput("linePlot")
    )
  )
)

# Create the server function for the Shiny app
server <- function(input, output) {
  
  # Create the plot based on selected year
  output$linePlot <- renderPlot({
    # Filter data based on selected year
    filtered_data <- data %>%
      filter(substr(Year_Month, 1, 3) == input$year)
    
    # Plot the line chart with points
    ggplot(filtered_data, aes(x = Year_Month, y = Value)) +
      geom_line() +
      geom_point() +
      theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
      labs(x = "月份", y = "數值", title = paste(input$year, "年度折線圖"))
  })
}

# Run the Shiny app
shinyApp(ui = ui, server = server)

